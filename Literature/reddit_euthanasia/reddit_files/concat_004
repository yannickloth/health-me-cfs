SML.di("./Dw4vb8Yfbm.js",import.meta.url,"Dw4vb8Yfbm");SML.di("./5r73EsgItq.js",import.meta.url,"5r73EsgItq");SML.di("./DnNITwgp90.js",import.meta.url,"DnNITwgp90");SML.di("./lEw4CeTWZd.js",import.meta.url,"lEw4CeTWZd");SML.di("./DbR4o2_jjG.js",import.meta.url,"DbR4o2_jjG");SML.di("./CiWOfYD0Yp.js",import.meta.url,"CiWOfYD0Yp");SML.di("./_Qc0cvBRUp.js",import.meta.url,"_Qc0cvBRUp");SML.di("./BhZAdnVq89.js",import.meta.url,"BhZAdnVq89");SML.di("./Py4YQhl7Hl.js",import.meta.url,"Py4YQhl7Hl");SML.di("./CZLMnmUH44.js",import.meta.url,"CZLMnmUH44");SML.di("./BNvs6GxKML.js",import.meta.url,"BNvs6GxKML");SML.di("./BOFc1KQJc-.js",import.meta.url,"BOFc1KQJc-");SML.di("./CBbxnHsw2W.js",import.meta.url,"CBbxnHsw2W");SML.di("./CEs3hLX56z.js",import.meta.url,"CEs3hLX56z");SML.di("./B-zFJtiar6.js",import.meta.url,"B-zFJtiar6");SML.di("./D_6DXw1u0k.js",import.meta.url,"D_6DXw1u0k");SML.di("./CE5TLxi7Z3.js",import.meta.url,"CE5TLxi7Z3");SML.di("./CP7i5b9l2n.js",import.meta.url,"CP7i5b9l2n");SML.di("./DflF56Kkuz.js",import.meta.url,"DflF56Kkuz");SML.di("./CQrDBXK-hm.js",import.meta.url,"CQrDBXK-hm");SML.di("./DgFeZwOkXZ.js",import.meta.url,"DgFeZwOkXZ");SML.di("./DOqOHj9jA9.js",import.meta.url,"DOqOHj9jA9");SML.di("./jWC3N3n7Al.js",import.meta.url,"jWC3N3n7Al");SML.di("./FQGvCwaizg.js",import.meta.url,"FQGvCwaizg");SML.di("./DoSzdRrY_z.js",import.meta.url,"DoSzdRrY_z");SML.di("./CsrbxKoUKW.js",import.meta.url,"CsrbxKoUKW");SML.di("./C8QDHFSIkY.js",import.meta.url,"C8QDHFSIkY");SML.di("./JaGlTj3I-9.js",import.meta.url,"JaGlTj3I-9");SML.di("./CRzmHkIoo0.js",import.meta.url,"CRzmHkIoo0");SML.di("./tQR1yVDIYU.js",import.meta.url,"tQR1yVDIYU");SML.di("./BLrhRle6xP.js",import.meta.url,"BLrhRle6xP");SML.di("./CYyPrSfG5V.js",import.meta.url,"CYyPrSfG5V");SML.di("./BJ81pSwong.js",import.meta.url,"BJ81pSwong");SML.di("./7fhA7FmrLv.js",import.meta.url,"7fhA7FmrLv");SML.di("./DCfD6rLr03.js",import.meta.url,"DCfD6rLr03");SML.di("./Dm3xIDznQh.js",import.meta.url,"Dm3xIDznQh");SML.di("./CdmJSaSHd8.js",import.meta.url,"CdmJSaSHd8");SML.di("./TELHDd3mgM.js",import.meta.url,"TELHDd3mgM");SML.di("./DMGDObG7XA.js",import.meta.url,"DMGDObG7XA");SML.di("./BOhFIvFWxC.js",import.meta.url,"BOhFIvFWxC");SML.di("./Dr-661gpDM.js",import.meta.url,"Dr-661gpDM");SML.di("./D2GdwS8jc7.js",import.meta.url,"D2GdwS8jc7");SML.di("./DvtJ_U6Duj.js",import.meta.url,"DvtJ_U6Duj");SML.di("./CQMf561ZyA.js",import.meta.url,"CQMf561ZyA");SML.di("./BwcUp7XlaC.js",import.meta.url,"BwcUp7XlaC");SML.di("./BIzQFHISzm.js",import.meta.url,"BIzQFHISzm");SML.di("./BwcMg3lXAs.js",import.meta.url,"BwcMg3lXAs");SML.di("./B0pL5bhFHV.js",import.meta.url,"B0pL5bhFHV");SML.di("./BtqmVQuPYp.js",import.meta.url,"BtqmVQuPYp");
SML.dm("BMwRkyrTru",["Dw4vb8Yfbm","5r73EsgItq","DnNITwgp90","lEw4CeTWZd","DbR4o2_jjG","CiWOfYD0Yp","_Qc0cvBRUp","Py4YQhl7Hl","CZLMnmUH44","BNvs6GxKML","BOFc1KQJc-","CEs3hLX56z","B-zFJtiar6","CQrDBXK-hm","BhZAdnVq89","CBbxnHsw2W","D_6DXw1u0k","CE5TLxi7Z3","CP7i5b9l2n","DflF56Kkuz","DgFeZwOkXZ","DOqOHj9jA9","jWC3N3n7Al","FQGvCwaizg","DoSzdRrY_z","CsrbxKoUKW","C8QDHFSIkY","JaGlTj3I-9","CRzmHkIoo0","tQR1yVDIYU","BLrhRle6xP","CYyPrSfG5V","BJ81pSwong","7fhA7FmrLv","DCfD6rLr03","Dm3xIDznQh","CdmJSaSHd8","TELHDd3mgM","DMGDObG7XA","BOhFIvFWxC","Dr-661gpDM","D2GdwS8jc7","DvtJ_U6Duj","CQMf561ZyA","BwcUp7XlaC","BIzQFHISzm","BwcMg3lXAs","B0pL5bhFHV","BtqmVQuPYp"],(async(e,t,o,i,n,s,a,r,m,l,d,c,u,h)=>{class p{constructor(t){this.draftId=null,this._restoredDraft=!1,this.addInputListener=()=>{this.host.addEventListener("input",this.onInput)},this.removeInputListener=()=>{this.host.removeEventListener("input",this.onInput)},this.hasActiveDraft=()=>Boolean(this.draftId),this.deleteCurrentDraft=(t,o)=>{if(this.draftId){s.d(t,this.draftId),this.draftId=null;const i=this.host.getComposer()?.plainText;o===e.l1.Discard&&e.i(this.host,a.c(a.C.Delete,i?.length)),this._restoredDraft&&o===e.l1.Submit&&e.i(this.host,a.c(a.C.Submit,i?.length))}this._restoredDraft=!1},this.restoreDraft=()=>{if(!this.draftId||!this.host.userId)return;const t=s.a(this.host.userId,this.draftId);if(!t)return;const o=this.host.getComposer();if(o&&(o.mode=t.mode,o.value=t.mode===e.bR.Markdown?t.content:JSON.parse(t.content),!this._restoredDraft)){(async()=>{await this.host.composerLoaded();const t=o.plainText;e.i(this.host,a.c(a.C.Open,t.length))})(),this._restoredDraft=!0}},this.resetRestoredDraft=()=>{this._restoredDraft=!1},this.onInput=e.ao((()=>{const t=this.host.userId,o=this.host.getComposer();if(!o)return;if(o.hasMedia||o.isEmpty())return void this.deleteCurrentDraft(t,e.l1.Other);const i=o.mode,n=o.value;if(this.draftId)s.u(t,this.draftId,{content:n,mode:i});else{const r=this.host.getPost();this.draftId=s.c(t,{content:n,mode:i,parentCommentId:this.host.parentId,postId:this.host.postId,postTitle:r?.postTitle??"",subredditPrefixedName:r?.subredditPrefixedName??""},(()=>{const t=o.plainText;e.i(this.host,a.c(a.C.AutoDelete,t.length))}))}}),2e3),this.host=t,t.addController(this)}hostConnected(){if(this.host.shouldEnableDrafts){const e=this.host.userId,t=this.host.postId;this.addInputListener();const o=this.host.parentId;this.draftId=s.b(e,{postId:t,parentCommentId:o})?.id}}hostDisconnected(){this.removeInputListener(),this._restoredDraft=!1}}const E="Received invalid data from EvaluateCommentAutomationsByPostId GQL query";const T="Received invalid data from GetIsCommentGuidanceAvailableFromPostId GQL query";const C={AutomationBlockOutcome:"block",AutomationInformOutcome:"inform",AutomationReportOutcome:"report"};class g{constructor(t){this.host=t,this.postId="",this._commentGuidanceRuleOutcomes=[],this._hasFocus=!1,this.hasSubmitted=!1,this.isCheckCommentGuidanceAvailabilitySet=!1,this.isPerformCommentGuidanceEvaluationSet=!1,this.performEvaluateAutomationsOnSubmit=!1,this.isCommentGuidanceAvailable=!1,this.composerSessionId="",this.focusTimeout=null,this.debouncedCommentGuidanceEvaluation=e.ao((async(e,t)=>{if(!this.isCommentGuidanceAvailable||!this.isPerformCommentGuidanceEvaluationSet)return;const o=this.hasBlockingRules;await this.performCommentGuidanceEvaluation(e);this.hasBlockingRules!==o&&t()}),100),this.onFocusIn=()=>{this.clearFocusTimeout(),this.updateFocusedState(!0)},this.onFocusOut=()=>{this.clearFocusTimeout(),this.focusTimeout=setTimeout((()=>this.updateFocusedState(!1)),200)},this.checkIfCommentGuidanceIsAvailable=async()=>{if(this.isCheckCommentGuidanceAvailabilitySet)try{if(!this.postId)throw new Error("Post Id is not set");this.isCommentGuidanceAvailable=await async function(t){const o={postId:t},{errors:i,data:n}=await e.Y({operation:e.O.GetIsCommentGuidanceAvailableFromPostId,variables:o});if(i&&i.length>0)throw new Error(T);if("SubredditPost"!==n.postInfoById?.__typename)throw new Error(T);const s=n?.postInfoById?.subreddit?.isCommentGuidanceAvailable;if("boolean"!=typeof s)throw new Error(T);return s}(this.postId)}catch(e){window.Sentry?.captureMessage?.(`Error checking comment guidance availability: ${e?.message}`)}},this.host=t,t.addController(this)}hostConnected(){this.host.addEventListener("focusin",this.onFocusIn),this.host.addEventListener("focusin",this.checkIfCommentGuidanceIsAvailable,{once:!0}),this.host.addEventListener("focusout",this.onFocusOut)}hostDisconnected(){this.host.removeEventListener("focusin",this.onFocusIn),this.host.removeEventListener("focusin",this.checkIfCommentGuidanceIsAvailable),this.host.removeEventListener("focusout",this.onFocusOut)}get hasFocus(){return this._hasFocus}get commentGuidanceRuleOutcomes(){return this._commentGuidanceRuleOutcomes.slice()}get hasBlockingRules(){return r.h(this.commentGuidanceRuleOutcomes)}get visibleTriggeredRuleIdSet(){const e=this.host.shadowRoot?.querySelector("automation-rule-triggered-rules");return new Set(e?.visibleRuleIds??[])}_getFeatureFlags(){return{isCheckCommentGuidanceAvailabilitySet:this.isCheckCommentGuidanceAvailabilitySet,isPerformCommentGuidanceEvaluationSet:this.isPerformCommentGuidanceEvaluationSet,performEvaluateAutomationsOnSubmit:this.performEvaluateAutomationsOnSubmit}}_getIsCommentGuidanceAvailable(){return this.isCommentGuidanceAvailable}_setIsCommentGuidanceAvailable(e){this.isCommentGuidanceAvailable=e}initialize(e){var t;this.postId=(t=e.postId)&&t.length>0&&!t.includes("t3_")?`t3_${t}`:t,this.updateComposerSessionId(e.composerSessionId),this.isCheckCommentGuidanceAvailabilitySet=e.isCheckCommentGuidanceAvailabilitySet??!1,this.isPerformCommentGuidanceEvaluationSet=e.isPerformCommentGuidanceEvaluationSet??!1,this.performEvaluateAutomationsOnSubmit=e.performEvaluateAutomationsOnSubmit??!1}updateSubmittedState(e){this.hasSubmitted=e}updateComposerSessionId(e){this.composerSessionId=e}async shouldAllowCommentSubmission(e){return!(this.isCommentGuidanceAvailable&&this.isPerformCommentGuidanceEvaluationSet&&this.performEvaluateAutomationsOnSubmit)||(await this.performCommentGuidanceEvaluation(e),!this.hasBlockingRules)}updateFocusedState(e){this._hasFocus=e,this.host.requestUpdate()}clearFocusTimeout(){this.focusTimeout&&(clearTimeout(this.focusTimeout),this.focusTimeout=null)}async performCommentGuidanceEvaluation(t){if(this.isCommentGuidanceAvailable&&this.isPerformCommentGuidanceEvaluationSet)try{if(!this.postId)throw new Error("PostId has not been set");const o=await async function(t,o){const i={postId:t,input:o},{errors:n,data:s}=await e.Y({operation:e.O.EvaluateCommentAutomationsByPostId,variables:i});if(n&&n.length>0)throw new Error(E);if("SubredditPost"!==s.postInfoById?.__typename)throw new Error(E);const a=s?.postInfoById?.subreddit?.evaluateCommentAutomations?.ok;if(!a)throw new Error(E);return s.postInfoById.subreddit.evaluateCommentAutomations}(this.postId,{commentBody:t,onOrAfterSubmit:this.hasSubmitted});this._commentGuidanceRuleOutcomes=o.result?.outcomes??[],this.host.requestUpdate(),this.trackCommentGuidanceViewEvent()}catch(e){window.Sentry?.captureMessage?.(`Error evaluating comment guidance: ${e?.message}`)}}trackCommentGuidanceViewEvent(){const t=this.visibleTriggeredRuleIdSet,o=((t,o)=>{const i=[],n=new Set;if(t.forEach((e=>{const t=e.automation?.id;if(t&&i.push(t),e.__typename){const t=C[e.__typename];n.add(t)}})),!i.length)return null;const s=[...n].join(",");return e.b({source:e.fm,action:"view",noun:"comment_guidance"},{action_info:{page_type:e.H(),reason:s},automoderator:{automod_comment_guidance_ids:i,composer_session_id:o}})})(this._commentGuidanceRuleOutcomes.filter((e=>!t.has(e.automation?.id??""))),this.composerSessionId);o&&e.i(this.host,o)}}let I;const b=new Uint8Array(16);function f(){if(!I&&(I="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(b)}var S=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const v=[];for(let e=0;e<256;++e)v.push((e+256).toString(16).slice(1));function _(e,t=0){return(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase()}function k(e){if(!function(e){return"string"==typeof e&&S.test(e)}(e))throw TypeError("Invalid UUID");let t;const o=new Uint8Array(16);return o[0]=(t=parseInt(e.slice(0,8),16))>>>24,o[1]=t>>>16&255,o[2]=t>>>8&255,o[3]=255&t,o[4]=(t=parseInt(e.slice(9,13),16))>>>8,o[5]=255&t,o[6]=(t=parseInt(e.slice(14,18),16))>>>8,o[7]=255&t,o[8]=(t=parseInt(e.slice(19,23),16))>>>8,o[9]=255&t,o[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,o[11]=t/4294967296&255,o[12]=t>>>24&255,o[13]=t>>>16&255,o[14]=t>>>8&255,o[15]=255&t,o}function R(e,t,o){function i(e,i,n,s){var a;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let o=0;o<e.length;++o)t.push(e.charCodeAt(o));return t}(e)),"string"==typeof i&&(i=k(i)),16!==(null===(a=i)||void 0===a?void 0:a.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let r=new Uint8Array(16+e.length);if(r.set(i),r.set(e,i.length),r=o(r),r[6]=15&r[6]|t,r[8]=63&r[8]|128,n){s=s||0;for(let e=0;e<16;++e)n[s+e]=r[e];return n}return _(r)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}function D(e){return 14+(e+64>>>9<<4)+1}function y(e,t){const o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function L(e,t,o,i,n,s){return y((a=y(y(t,e),y(i,s)))<<(r=n)|a>>>32-r,o);var a,r}function N(e,t,o,i,n,s,a){return L(t&o|~t&i,e,t,n,s,a)}function A(e,t,o,i,n,s,a){return L(t&i|o&~i,e,t,n,s,a)}function M(e,t,o,i,n,s,a){return L(t^o^i,e,t,n,s,a)}function P(e,t,o,i,n,s,a){return L(o^(t|~i),e,t,n,s,a)}R("v3",48,(function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let o=0;o<t.length;++o)e[o]=t.charCodeAt(o)}return function(e){const t=[],o=32*e.length,i="0123456789abcdef";for(let n=0;n<o;n+=8){const o=e[n>>5]>>>n%32&255,s=parseInt(i.charAt(o>>>4&15)+i.charAt(15&o),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[D(t)-1]=t;let o=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){const a=o,r=i,m=n,l=s;o=N(o,i,n,s,e[t],7,-680876936),s=N(s,o,i,n,e[t+1],12,-389564586),n=N(n,s,o,i,e[t+2],17,606105819),i=N(i,n,s,o,e[t+3],22,-1044525330),o=N(o,i,n,s,e[t+4],7,-176418897),s=N(s,o,i,n,e[t+5],12,1200080426),n=N(n,s,o,i,e[t+6],17,-1473231341),i=N(i,n,s,o,e[t+7],22,-45705983),o=N(o,i,n,s,e[t+8],7,1770035416),s=N(s,o,i,n,e[t+9],12,-1958414417),n=N(n,s,o,i,e[t+10],17,-42063),i=N(i,n,s,o,e[t+11],22,-1990404162),o=N(o,i,n,s,e[t+12],7,1804603682),s=N(s,o,i,n,e[t+13],12,-40341101),n=N(n,s,o,i,e[t+14],17,-1502002290),i=N(i,n,s,o,e[t+15],22,1236535329),o=A(o,i,n,s,e[t+1],5,-165796510),s=A(s,o,i,n,e[t+6],9,-1069501632),n=A(n,s,o,i,e[t+11],14,643717713),i=A(i,n,s,o,e[t],20,-373897302),o=A(o,i,n,s,e[t+5],5,-701558691),s=A(s,o,i,n,e[t+10],9,38016083),n=A(n,s,o,i,e[t+15],14,-660478335),i=A(i,n,s,o,e[t+4],20,-405537848),o=A(o,i,n,s,e[t+9],5,568446438),s=A(s,o,i,n,e[t+14],9,-1019803690),n=A(n,s,o,i,e[t+3],14,-187363961),i=A(i,n,s,o,e[t+8],20,1163531501),o=A(o,i,n,s,e[t+13],5,-1444681467),s=A(s,o,i,n,e[t+2],9,-51403784),n=A(n,s,o,i,e[t+7],14,1735328473),i=A(i,n,s,o,e[t+12],20,-1926607734),o=M(o,i,n,s,e[t+5],4,-378558),s=M(s,o,i,n,e[t+8],11,-2022574463),n=M(n,s,o,i,e[t+11],16,1839030562),i=M(i,n,s,o,e[t+14],23,-35309556),o=M(o,i,n,s,e[t+1],4,-1530992060),s=M(s,o,i,n,e[t+4],11,1272893353),n=M(n,s,o,i,e[t+7],16,-155497632),i=M(i,n,s,o,e[t+10],23,-1094730640),o=M(o,i,n,s,e[t+13],4,681279174),s=M(s,o,i,n,e[t],11,-358537222),n=M(n,s,o,i,e[t+3],16,-722521979),i=M(i,n,s,o,e[t+6],23,76029189),o=M(o,i,n,s,e[t+9],4,-640364487),s=M(s,o,i,n,e[t+12],11,-421815835),n=M(n,s,o,i,e[t+15],16,530742520),i=M(i,n,s,o,e[t+2],23,-995338651),o=P(o,i,n,s,e[t],6,-198630844),s=P(s,o,i,n,e[t+7],10,1126891415),n=P(n,s,o,i,e[t+14],15,-1416354905),i=P(i,n,s,o,e[t+5],21,-57434055),o=P(o,i,n,s,e[t+12],6,1700485571),s=P(s,o,i,n,e[t+3],10,-1894986606),n=P(n,s,o,i,e[t+10],15,-1051523),i=P(i,n,s,o,e[t+1],21,-2054922799),o=P(o,i,n,s,e[t+8],6,1873313359),s=P(s,o,i,n,e[t+15],10,-30611744),n=P(n,s,o,i,e[t+6],15,-1560198380),i=P(i,n,s,o,e[t+13],21,1309151649),o=P(o,i,n,s,e[t+4],6,-145523070),s=P(s,o,i,n,e[t+11],10,-1120210379),n=P(n,s,o,i,e[t+2],15,718787259),i=P(i,n,s,o,e[t+9],21,-343485551),o=y(o,a),i=y(i,r),n=y(n,m),s=y(s,l)}return[o,i,n,s]}(function(e){if(0===e.length)return[];const t=8*e.length,o=new Uint32Array(D(t));for(let i=0;i<t;i+=8)o[i>>5]|=(255&e[i/8])<<i%32;return o}(e),8*e.length))}));var O={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function w(e,t,o){if(O.randomUUID&&!e)return O.randomUUID();const i=(e=e||{}).random||(e.rng||f)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,_(i)}function H(e,t,o,i){switch(e){case 0:return t&o^~t&i;case 1:case 3:return t^o^i;case 2:return t&o^t&i^o&i}}function j(e,t){return e<<t|e>>>32-t}R("v5",80,(function(e){const t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let o=0;o<t.length;++o)e.push(t.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,n=Math.ceil(i/16),s=new Array(n);for(let t=0;t<n;++t){const o=new Uint32Array(16);for(let i=0;i<16;++i)o[i]=e[64*t+4*i]<<24|e[64*t+4*i+1]<<16|e[64*t+4*i+2]<<8|e[64*t+4*i+3];s[t]=o}s[n-1][14]=8*(e.length-1)/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<n;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=s[e][t];for(let e=16;e<80;++e)i[e]=j(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let n=o[0],a=o[1],r=o[2],m=o[3],l=o[4];for(let e=0;e<80;++e){const o=Math.floor(e/20),s=j(n,5)+H(o,a,r,m)+l+t[o]+i[e]>>>0;l=m,m=r,r=j(a,30)>>>0,a=n,n=s}o[0]=o[0]+n>>>0,o[1]=o[1]+a>>>0,o[2]=o[2]+r>>>0,o[3]=o[3]+m>>>0,o[4]=o[4]+l>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}));const U="comment_composer",z=t=>e.b({source:U,noun:"comment",action:"submit"},t),G=()=>e.b({source:U,noun:"edit_error",action:"click"}),B=t=>e.b({source:U,noun:"comment",action:"error"},t);class F{constructor(t){this.pasteEventList=[],this.maxPastedCharsLen=0,this.openClientTimestamp=0,this.openMousePosition={x:-1,y:-1},this.currMousePosition={x:-1,y:-1},this.inputField=null,this.getOpenClientTimestamp=()=>this.openClientTimestamp,this.getOpenMousePosition=()=>this.openMousePosition,this.getCurrMousePosition=()=>this.currMousePosition,this.setOpenMousePosition=()=>{this.openMousePosition=this.currMousePosition},this.setOpenClientTimestamp=()=>{this.openClientTimestamp=this.getTimestamp()},this.handleModeChangeListeners=async()=>{this.inputField=await this.getInputField(),this.inputField?.addEventListener("paste",this.handlePasteEvent)},this.markdownComposerLoaded=async()=>{this.host.getComposer()&&(await window.customElements.whenDefined("shreddit-markdown-composer"))},this.getInputField=async()=>(await this.host.composerLoaded(),this.host.isMobile?this.host.getComposer().shadowRoot.querySelector('div[role="textbox"]'):this.host.getComposer().mode===e.bR.Markdown?(await this.markdownComposerLoaded(),this.getMarkdownComposer().shadowRoot?.querySelector("textarea")):this.host.getComposer().querySelector('div[slot="rte"]')),this.hostConnected=async()=>{this.host.composerLoaded(),this.inputField=await this.getInputField(),this.openClientTimestamp=this.getTimestamp(),this.initEventListeners(),this.connectedPromiseResolve?.()},this.handlePasteEvent=e=>{if(this.pasteEventList.length<100){const t=(e.clipboardData?.getData("text/plain")||"").replace(/\r\n|\r|\n/g,""),o=this.getTimestamp();t.length>this.maxPastedCharsLen&&(this.maxPastedCharsLen=t.length),setTimeout((()=>{const e=this.inputField instanceof HTMLTextAreaElement?this.inputField?.value.length||0:this.inputField?.innerText?.length||0;this.pasteEventList.push({clientTimestamp:o,charsPastedLen:t.length,mousePosition:this.currMousePosition,maxPastedCharsLen:this.maxPastedCharsLen,totalTextLen:e})}),0)}},this.handleMouseMove=e.ao((e=>{this.currMousePosition={x:e.clientX,y:e.clientY}}),50),this.handleTouchStart=e=>{const t=e.changedTouches;t[0].screenX&&t[0].screenY&&(this.currMousePosition={x:Math.round(t[0].screenX),y:Math.round(t[0].screenY)})},this.buildPasteCommentEvent=t=>e.b({source:"comment_composer",noun:"text",action:"paste"},t),this.dispatchV2PasteEvents=t=>{if(t)for(const o of this.pasteEventList)e.i(this.host,this.buildPasteCommentEvent({comment:{id:t},action_info:{paste_client_timestamp:o.clientTimestamp,total_text_length:o.totalTextLen,characters_pasted_length:o.charsPastedLen,max_pasted_characters_length:this.maxPastedCharsLen,curr_mouse_position_x:o.mousePosition.x,curr_mouse_position_y:o.mousePosition.y},automoderator:{composer_session_id:this.host.composerSessionId}}))},this.reset=()=>{this.pasteEventList=[],this.maxPastedCharsLen=0,this.currMousePosition={x:-1,y:-1}},this.host=t,this.connectedPromise=new Promise((e=>{this.connectedPromiseResolve=e})),t.addController(this)}async isConnected(){return this.connectedPromise}getMarkdownComposer(){return this.host.getComposer().shadowRoot.querySelector("shreddit-markdown-composer")}getTimestamp(){return(new Date).getTime()}initEventListeners(){this.host.isMobile?document.addEventListener("touchstart",this.handleTouchStart):document.addEventListener("mousemove",this.handleMouseMove),this.inputField?.addEventListener("paste",this.handlePasteEvent)}hostDisconnected(){this.host.isMobile?document.removeEventListener("touchstart",this.handleTouchStart):document.removeEventListener("mousemove",this.handleMouseMove),this.inputField?.removeEventListener("paste",this.handlePasteEvent)}}const x="cg-error";let K=class extends t.s{constructor(){super(...arguments),this.isCheckCommentGuidanceAvailabilitySet=!1,this.isPerformCommentGuidanceEvaluationSet=!1,this.performEvaluateAutomationsOnSubmit=!1,this.composerSessionId=w(),this.shouldDisplayContent=!1,this.isTranslatedCommentSubmit=!1,this.translationContextValue=e.aQ,this.isInEditMode=!1,this.isInReplyMode=!1,this.isMobile=!1,this.autofocus=!1,this.isTranslationContribution=!1,this.shouldShowSuccessAlert=!1,this.isCommentDraftsEnabled=!1,this.commentGuidanceController=new g(this),this.commentDraftsController=new p(this),this.commentPasteController=new F(this),this.windowEvents=new e.E(this,(()=>window)),this.eventsController=new e.E(this),this.commentSubmitClickTimestamp=0,this.commentSubmitTimestamp=0,this.composerLoaded=async()=>{const e=this.getComposer();e&&(await window.customElements.whenDefined(e.tagName.toLowerCase()))},this.onFirstInput=this.eventsController.define("input",(()=>{this.windowEvents.define("beforeunload",(e=>{void 0===this.getComposer().initialValue&&this.getComposer().isEmpty()||this.commentDraftsController.hasActiveDraft()||e.preventDefault()})),this.commentPasteController.setOpenMousePosition()}),{once:!0}),this._describedById="",this.handleInitialFocus=e=>{e.stopPropagation(),this.shouldDisplayContent=!0,document.querySelector(h.S)?.setAttribute("pageindex","1"),this.commentPasteController.setOpenClientTimestamp(),this.commentPasteController.setOpenMousePosition()},this.openCommentComposer=e=>{this.handleInitialFocus(e),this.focus()},this.init=({shouldDisplayContent:t})=>{this.removeEventListener("focusin",this.handleInitialFocus),this.removeEventListener("click",this.handleInitialFocus),document.removeEventListener("open-comment-composer",this.openCommentComposer),this.getComposer()?.setAttribute("aria-describedby",this.getDescribedById()),this.isComposerDirty=!1,this.shouldDisplayContent=t,this.hasPlaceholder()&&(this.addEventListener("focusin",this.handleInitialFocus,{once:!0}),document.addEventListener("open-comment-composer",this.openCommentComposer),e.l2(e.l3())&&this.addEventListener("click",this.handleInitialFocus,{once:!0}))},this.handleSubmitButtonClick=async e=>{e.stopPropagation(),e.preventDefault();const t=this.getPost();if(t&&t.isTranslatable&&this.addTranslationParamToForm(u.da,"true"),this.isTranslationToggleVisible()){const e=this.getTranslationToggle();if(e&&!e.checked&&this.translationContextValue.showCommentTranslationModal)return void this.commentTranslationModal?.showTranslationModal();e&&e.checked&&(this.addTranslationParamToForm(u.db,this.translationLanguage),this.isTranslatedCommentSubmit=!0)}this.submitCommentClick()},this.submitCommentClick=async()=>{this.commentSubmitClickTimestamp=performance.now(),this.commentGuidanceController.updateSubmittedState(!0);const t=this.getComposer();if(!(await this.commentGuidanceController.shouldAllowCommentSubmission(t.plainText)))return t.setCustomValidity(x),t.reportValidity(),this.isComposerDirty=!0,void this.updateSlottedElements();await Promise.race([this.getRecaptchaToken(),e.e2(n.R)]),this.querySelector('button[slot="submit-button"]')?.focus(),this.getForm()?.click()},this._events=new e.E(this),this.parentCommentElement=null,this._shredditComposer=null,this._composer=null,this._getLocationSearch=()=>window.location.search,this._goBack=()=>window.history.back(),this.redirectBackWhenCommentReplyCancelled=()=>{const e=new URLSearchParams(this._getLocationSearch()),t=e.get("reply"),o="1"===e.get("draft"),i=this.querySelector('input[name="parentId"]')?.value;t!==i||o||this._goBack()},this.isTranslationToggleVisible=()=>!!this.translationContextValue.isTranslationActive&&!!this.getTranslationToggle(),this.sendTranslateCommentSubmitEvent=(t,o)=>{const i=this.getPost();let n;i&&(n={id:i.id,permalink:i.permalink,postLanguage:i.postLanguage,postType:i.postType,subredditId:i.subredditId||"",subredditPrefixedName:i.subredditPrefixedName||""}),e.i(this,m.x(t,n,o))},this.sendCommentSuccessEvent=(t,o)=>{const i=o||this,n=this.commentPasteController.getOpenMousePosition(),s=this.commentPasteController.getCurrMousePosition();var a;e.i(i,(a={comment:{id:t??""},automoderator:{composer_session_id:this.composerSessionId},action_info:{curr_mouse_position_x:s.x,curr_mouse_position_y:s.y},comment_composer:{open_mouse_position_x:n.x,open_mouse_position_y:n.y,open_client_timestamp:this.commentPasteController.getOpenClientTimestamp(),success_client_timestamp:this.commentPasteController.getTimestamp()},timer:{millis:Math.floor(performance.now()-this.commentSubmitClickTimestamp),type:e.a_.Latency}},e.b({source:U,noun:"success",action:"click"},a))),e.i(i,z({comment_composer:{submission_latency_seconds:this.getSubmissionLatencySeconds()},action_info:{success:!0},media:this.getComposerMediaInfo()})),this.commentPasteController.reset()},this.handleTranslationRefuseClick=()=>{this.removeTranslationParamFromForm(),this.isTranslatedCommentSubmit=!1,this.submitCommentClick()},this.handleTranslationConfirmClick=()=>{this.addTranslationParamToForm(u.db,this.translationLanguage),this.isTranslatedCommentSubmit=!0,this.submitCommentClick()},this.addTranslationParamToForm=(t,o)=>{const i=this.getForm();if(i&&o){const n=i.getAttribute("action");n&&i.setAttribute("action",e.cb(n,t,o))}},this.removeTranslationParamFromForm=()=>{const t=this.getForm();if(t){const o=t.getAttribute("action");o&&t.setAttribute("action",e.l4(o,u.db))}},this.handleCancelButtonClick=e=>{e.preventDefault(),e.stopPropagation();const t=this.getComposer();t?.isEmpty()?(t?.clear(),this.publishCommentComposerBlurred(),this.dispatchEvent(new CustomEvent(u.b0,{bubbles:!0,cancelable:!0})),this.redirectBackWhenCommentReplyCancelled()):this.shouldEnableDrafts?this.draftConfirmationModal?.showModal():this.cancelConfirmationModal?.showModal()},this.handleCancelDraft=this._events.define(u.b0,this.reset),this.handleInputFocus=this._events.define("input-focus",(()=>{var t;this.scrollIntoViewIfNeeded({block:"center"}),this.updateMentionAutocompleteValues(),e.i(this,(t={action_info:{type:this.isInEditMode?"edit":this.isInReplyMode?"reply":"add"},automoderator:{composer_session_id:this.composerSessionId}},e.b({source:U,noun:"input",action:"click"},t)))})),this.handleModeChange=this._events.define(e.fN,(t=>{t.detail.activeMode===e.bR.Markdown?(this.isComposerReady=!0,this.updateSlottedElements(),e.i(this,e.b({source:U,noun:"markdown_mode",action:"click"}))):t.detail.activeMode===e.bR.RichText&&e.i(this,e.b({source:U,noun:"rich_text_editor",action:"click"})),this.commentPasteController.handleModeChangeListeners()})),this.handleOpenImageTooltip=this._events.define("open-image-tooltip",(()=>{e.i(this,e.b({source:U,noun:"images_tooltip",action:"open"}))})),this.handleOpenGiphyTooltip=this._events.define("open-giphy-tooltip",(()=>{e.i(this,e.b({source:U,noun:"gif_tooltip",action:"open"}))})),this.handleSelectGiphyImage=this._events.define("select-giphy-image",(()=>{e.i(this,e.b({source:U,noun:"gif_tooltip_result",action:"select"}))})),this.handleOpenVideoTooltip=this._events.define("open-video-tooltip",(()=>{e.i(this,e.b({source:U,noun:"video_tooltip",action:"open"}))})),this.handleImageError=this._events.define("image-error",(t=>{e.i(this,(({reason:t})=>e.b({source:U,noun:"media",action:"reject"},{action_info:{reason:t}}))({reason:t.detail.reason}))})),this.handleRemoveImage=this._events.define("image-remove",(t=>{e.i(this,(({id:t,width:o,height:i,size:n,file_name:s,mimetype:a,source:r,url:m})=>e.b({source:U,noun:"image",action:"remove"},{media:{width:o,height:i,id:t,mimetype:a,size:n,url:m,source:r,file_name:s,type:c.M.Image}}))({id:t.detail.mediaId,url:t.detail.mediaUrl,mimetype:t.detail.mediaMimetype,width:t.detail.mediaWidth,size:t.detail.mediaSize,height:t.detail.mediaHeight,source:t.detail.mediaSource,file_name:t.detail.mediaFileName}))})),this.handleVideoError=this._events.define("video-error",(t=>{e.i(this,(({reason:t})=>e.b({source:U,noun:"media",action:"reject"},{action_info:{reason:t}}))({reason:t.detail.reason}))})),this.handleRemoveVideo=this._events.define("video-remove",(t=>{e.i(this,(({id:t,width:o,height:i,size:n,file_name:s,mimetype:a,source:r,url:m})=>e.b({source:U,noun:"video",action:"remove"},{media:{width:o,height:i,id:t,mimetype:a,size:n,url:m,source:r,file_name:s,type:c.M.Video}}))({id:t.detail.mediaId,url:t.detail.mediaUrl,mimetype:t.detail.mediaMimetype,width:t.detail.mediaWidth,size:t.detail.mediaSize,height:t.detail.mediaHeight,source:t.detail.mediaSource,file_name:t.detail.mediaFileName}))})),this.handleSubmit=this._events.define("faceplate-submit",(t=>{this.isComposerDirty=!0;const o=this.getComposer(),i=o?.reportValidity(),n=this.getPost(),s=n?.id;var a;i?this.commentId?e.i(this,(a={...(s && {post:{number_comments:n?.commentCount,id:n?.id}}),subreddit:{id:n?.subredditId},automoderator:{composer_session_id:this.composerSessionId}},e.b({source:U,noun:"edit_comment",action:"click"},a))):e.i(this,(t=>e.b({source:U,noun:"comment",action:"click"},t))({...(s && {post:{number_comments:n?.commentCount,id:n?.id}}),subreddit:{id:n?.subredditId},automoderator:{composer_session_id:this.composerSessionId}})):(this.updateCommentButton("disabled"),t.preventDefault()),this.requestUpdate()})),this.handleRequest=this._events.define("faceplate-request",(t=>{if(t.target!==this.getForm())return;this.commentSubmitTimestamp=performance.now();const o=this.getComposer(),i=t.detail.request.body;i.set("mode",o.mode),o.mode===e.bR.RichText&&i.set("richTextMedia",this.getShredditComposer()?.richTextMedia),this.updateCommentButton("pending");const n=i.get("commentId");if(n)return t.preventDefault(),this.updateComment({commentId:n.toString(),mode:o.mode,updatedContent:i.get("content")?.toString()||"",richTextMedia:i.get("richTextMedia")?.toString()||""}),e.co(this,{message:"Comment edited successfully",options:{priority:e.S.assertive}}),void this.commentGuidanceController.updateSubmittedState(!1);const s=i.get("parentId");if(s&&(this.parentCommentElement||(this.parentCommentElement=this.closest(`shreddit-comment[thingid="${s}"]`)),!this.parentCommentElement?.querySelector(':scope > [slot="next-reply"]'))){const t=e.fL("div",{id:`${s}-next-reply`,slot:"next-reply"});this.parentCommentElement?.appendChild(t)}})),this.handleFormAlert=this._events.define("faceplate-alert",(t=>{t.target===this.getForm()&&(e.i(this,B({action_info:{reason:t.detail.message},automoderator:{composer_session_id:this.composerSessionId}})),this.updateCommentButton("idle"),t.detail.message="Unable to create comment")})),this.handleResponse=this._events.define("faceplate-response",(async t=>{if(this.translationLanguage&&this.removeTranslationParamFromForm(),t.target!==this.getForm())return;const o=await t.detail.response.clone().text();if(this.updateCommentButton("idle"),o.includes("has-comment-guidance-error"))this.commentGuidanceController.updateSubmittedState(!0),this._onInput(),e.i(this,B({automoderator:{composer_session_id:this.composerSessionId}})),e.i(this,z({action_info:{success:!1,reason:o},comment_composer:{submission_latency_seconds:this.getSubmissionLatencySeconds()},media:this.getComposerMediaInfo()}));else if(o.includes("faceplate-alert"))e.i(this,B({automoderator:{composer_session_id:this.composerSessionId}})),e.i(this,z({action_info:{success:!1,reason:o},comment_composer:{submission_latency_seconds:this.getSubmissionLatencySeconds()},media:this.getComposerMediaInfo()}));else{const t=/thingId="([^"]*)"/,i=o.match(t);let n;if(i&&(n=i[1]),this.shouldShowSuccessAlert){const t=/<shreddit-comment[^>]*\sparent-permalink="([^"]+)"/,i=o.match(t),n=i&&i[1];this.dispatchEvent(e.c("faceplate-alert",{level:e.a5.info,message:"Your comment was submitted.",cause:void 0,namedContent:n?{action:e.o({children:"Go to comment",attributes:{href:n}})}:{}}))}this.isTranslationContribution&&this.translationContextValue.isTranslationActive&&this.sendTranslateCommentSubmitEvent(this.isTranslatedCommentSubmit,n),this.userId&&this.commentDraftsController.deleteCurrentDraft(this.userId,e.l1.Submit),this.publishCommentComposerBlurred(),this.commentPasteController.dispatchV2PasteEvents(n);const s=this.getClosestShredditComment();this.dispatchEvent(new CustomEvent(u.C,{bubbles:!0,composed:!0}));const a=this.postId??"",r={postId:a,parentThingId:this.parentCommentElement?.getAttribute("thingId")??a};e.p(e.T.CommentCreated,r),this.sendCommentSuccessEvent(n,s),e.co(this,{message:"Comment posted successfully"}),this.commentGuidanceController.updateSubmittedState(!1),this.parentCommentElement?.updateChildren?.(),this.reset()}})),this.handleCancelAbort=()=>{this.cancelConfirmationModal?.close()},this.handleCancelConfirmation=e=>{e.preventDefault(),e.stopPropagation(),this.cancelConfirmationModal?.close(),this.isInEditMode?this.getComposer()?.reset():this.getComposer()?.clear(),this.publishCommentComposerBlurred(),this.dispatchEvent(new CustomEvent(u.b0,{bubbles:!0,cancelable:!0})),this.redirectBackWhenCommentReplyCancelled(),this.commentPasteController.reset()},this.handleDraftSave=t=>{const o=this.getComposer()?.plainText;e.i(this,e.b(a.c(a.C.Save,o?.length))),this.closeComposerAfterDraftDecision(t)},this.closeComposerAfterDraftDecision=e=>{e.preventDefault(),e.stopPropagation(),this.draftConfirmationModal?.hide(),this.commentDraftsController.removeInputListener(),this.getComposer()?.clear(),this.commentDraftsController.addInputListener(),this.publishCommentComposerBlurred(),this.dispatchEvent(new CustomEvent(u.b0,{bubbles:!0,cancelable:!0})),this.redirectBackWhenCommentReplyCancelled()},this.handleDraftDiscard=t=>{this.userId&&this.commentDraftsController.deleteCurrentDraft(this.userId,e.l1.Discard),this.closeComposerAfterDraftDecision(t)},this.publishCommentComposerBlurred=()=>{e.p(e.T.CommentComposerBlurred,{commentId:this.getDescribedById()})},this.publishCommentComposerFocused=()=>{e.p(e.T.CommentComposerFocused,{commentId:this.getDescribedById()})},this.isComposerDirty=!1,this.updateSlottedElements=()=>{const e=this.isComposerDirty&&!this.getComposer()?.reportValidity()||!this.isComposerReady;this.updateCommentButton(e?"disabled":"idle"),this.requestUpdate()},this.debounceValidityCheck=e.ao((()=>{this.updateSlottedElements()}),250),this._onInput=()=>{if(this.debounceValidityCheck(),!this.isInEditMode){const e=this.getComposer(),t=()=>{e.setCustomValidity(this.commentGuidanceController.hasBlockingRules?x:""),e.reportValidity(),this.isComposerDirty=this.commentGuidanceController.hasBlockingRules,this.updateSlottedElements()};this.commentGuidanceController.debouncedCommentGuidanceEvaluation(e.plainText,t)}},this.handleInput=this._events.define("input",this._onInput),this.isComposerReady=!0,this.handleReadyStateChange=this._events.define(i.b,(e=>{this.isComposerReady=e.detail===i.a.Ready,this.updateSlottedElements()})),this.updateCommentButton=e=>{const t=this.querySelector('button[slot="submit-button"]');if(!t)return;const o=t.querySelector('[slot="content"]'),i=t.querySelector('[slot="spinner"]');switch(e){case"idle":t.disabled=!1,t.ariaLabel=null,t.classList.add("cursor-pointer"),t.classList.remove("cursor-not-allowed"),t.classList.remove("cursor-wait"),o.ariaHidden=null,o.style.opacity="1",i.classList.add("hidden");break;case"pending":t.disabled=!0,t.ariaLabel="Waiting for comment to be posted",t.classList.remove("cursor-pointer"),t.classList.remove("cursor-not-allowed"),t.classList.add("cursor-wait"),o.ariaHidden="true",o.style.opacity="0",i.classList.remove("hidden");break;case"disabled":t.disabled=!0,t.ariaLabel=null,t.classList.remove("cursor-pointer"),t.classList.add("cursor-not-allowed"),t.classList.remove("cursor-wait"),o.ariaHidden=null,o.style.opacity="1",i.classList.add("hidden")}}}get shouldEnableDrafts(){return Boolean(this.isCommentDraftsEnabled&&!this.isInEditMode&&this.userId&&this.postId)}focus(){const e=u.dc({adjacentElement:this});this.focusAsync().then((()=>{e()})).catch((t=>{e()}))}async focusAsync(){this.shouldDisplayContent||(this.shouldDisplayContent=!0,await this.updateComplete),await this.composerLoaded(),await this._focus(),this.publishCommentComposerFocused()}_focus(e=20){return new Promise(((t,o)=>{e<=0?o("Failed to focus composer-host."):window.requestAnimationFrame((()=>{this.getComposer()?.focus(),this.getComposer()?.hasFocus()?t():this._focus(e-1).then(t).catch(o)}))}))}firstUpdated(){this.autofocus&&this.focus();"1"===new URLSearchParams(this._getLocationSearch()).get("draft")&&!this.parentId&&this.commentDraftsController.hasActiveDraft()&&this.focus()}updateMentionAutocompleteValues(){const t=this.getShredditComposer();if(!t)return;const o=document.querySelector("shreddit-comment-tree");if(!o)return;const i=this.getPost(),n=Array.from(o.querySelectorAll("shreddit-comment:not([is-comment-deleted]):not([is-author-deleted])")),s=new Set,a=[];if(i){const e=i.getAttribute("author"),t=i.authorId;t&&e&&(s.add(e),a.push({id:t,username:e}))}for(const e of n){if(a.length>=50)break;const t=e.getAttribute("author");if(!s.has(t)){s.add(t);const o=e.getAttribute("thingId");a.push({id:o,username:t})}}const r=a.map((({username:t,id:o})=>e.fL("data",{value:"redditor",slot:"rte","data-name":t,"data-id":o}))),m=Array.from(t.querySelectorAll('data[value="redditor"]'));for(const e of m)e.remove();t.append(...r)}getDescribedById(){return this._describedById||(this._describedById=`comment-composer-message-${this.closest("shreddit-comment")?.getAttribute("thingId")??"root"}`),this._describedById}async getRecaptchaToken(){try{const e=this.getForm()?.querySelector(`input[name="${l.P.RecaptchaToken}"]`);if(e)await n.s(e,n.a.CommentSubmit);else if(!e)throw new Error("Unable to find recaptchaToken input")}catch(e){window.Sentry?.captureException?.(e)}}connectedCallback(){if(super.connectedCallback(),this.getCancelButton()?.addEventListener("click",this.handleCancelButtonClick),this.getCommentButton()?.addEventListener("click",this.handleSubmitButtonClick),this.init({shouldDisplayContent:!this.hasPlaceholder()}),this.isTranslationContribution){const e=this.getPost();e&&e.isTranslatable&&(this.translationLanguage=e.postLanguage)}this.commentGuidanceController.initialize({postId:this.postId??"",composerSessionId:this.composerSessionId,isCheckCommentGuidanceAvailabilitySet:this.isCheckCommentGuidanceAvailabilitySet,isPerformCommentGuidanceEvaluationSet:this.isPerformCommentGuidanceEvaluationSet,performEvaluateAutomationsOnSubmit:this.performEvaluateAutomationsOnSubmit})}disconnectedCallback(){this.getCancelButton()?.removeEventListener("click",this.handleCancelButtonClick),this.getCommentButton()?.removeEventListener("click",this.handleSubmitButtonClick),this.removeEventListener("focusin",this.handleInitialFocus),this.removeEventListener("click",this.handleInitialFocus),document.removeEventListener("open-comment-composer",this.openCommentComposer),super.disconnectedCallback()}hasPlaceholder(){return!!this.querySelector(":scope>*:not([slot])")}reset(){this.isInEditMode?this.getComposer()?.reset():this.getComposer()?.clear(),this.updateCommentButton("idle"),this.updateComplete.then((()=>{this.commentGuidanceController.updateSubmittedState(!1),this.init({shouldDisplayContent:!this.hasPlaceholder()})})),this.refreshComposerSessionId(),this.commentDraftsController.resetRestoredDraft()}getShredditComposer(){return this._shredditComposer??(this._shredditComposer=this.querySelector("shreddit-composer")),this._shredditComposer}getComposer(){return this._composer??(this._composer=this.getShredditComposer()||this.querySelector("shreddit-simple-composer")),this._composer}getCancelButton(){return this.querySelector('button[slot="cancel-button"]')}getCommentButton(){return this.querySelector('button[slot="submit-button"]')}getClosestShredditComment(){return this.closest("shreddit-comment")}getPost(){return document.querySelector(`shreddit-post[id*="${this.postId}"]`)}getTranslationToggle(){const e=this.querySelector("translation-contribution-toggle");return e?.shadowRoot?.querySelector("faceplate-switch-input")}refreshComposerSessionId(){this.composerSessionId=w(),this.commentGuidanceController.updateComposerSessionId(this.composerSessionId)}getSubmissionLatencySeconds(){return(performance.now()-this.commentSubmitTimestamp)/1e3}getComposerMediaInfo(){const e=this.getShredditComposer();if(!e)return;const t=e.redditRte?.getRichTextMedia();if(!t||0===t.length)return;const o=t[0];return{id:o.id,url:o.url,width:o.width,height:o.height,mimetype:o.mimetype,type:o.type,size:o.size}}scrollIntoViewIfNeeded(e){this.isMobile||function(e){const{top:t,bottom:o,left:i,right:n}=e.getBoundingClientRect();return t>=0&&o<=window.innerHeight&&i>=0&&n<=window.innerWidth}(this)||this.scrollIntoView(e)}getForm(){return this.querySelector("faceplate-form")}async updated(e){e.has("shouldDisplayContent")&&this.shouldDisplayContent&&(this.focus(),await this.composerLoaded(),this.commentDraftsController.restoreDraft())}async updateComment({commentId:t,mode:o,updatedContent:i,richTextMedia:n}){const s={input:{commentId:t,content:o===e.bR.RichText?{richText:i}:{markdown:i}}};this.isTranslatedCommentSubmit&&this.translationLanguage&&(s.input.targetLanguage=this.translationLanguage);const a="Something went wrong";try{const o=this.closest(`shreddit-comment[thingId="${t}"]`);if(!o)throw (this.dispatchEvent(e.c("faceplate-alert",{level:e.a5.error,message:"Something went wrong",cause:e.cv.UncaughtError})), e.i(this,G()), new Error("The origin shreddit-comment cannot be found"));const{data:i}=await e.Y({operation:e.O.UpdateComment,variables:s}),{ok:m,errors:l,fieldErrors:c}=i.updateComment||{};if(m){e.i(this,(r={comment:{id:t??""},automoderator:{composer_session_id:this.composerSessionId},timer:{millis:Math.floor(performance.now()-this.commentSubmitClickTimestamp),type:e.a_.Latency}},e.b({source:U,noun:"edit_success",action:"click"},r))),this.isTranslationContribution&&this.translationContextValue.isTranslationActive&&this.sendTranslateCommentSubmitEvent(this.isTranslatedCommentSubmit,t);const i={richTextMedia:n};this.isTranslatedCommentSubmit&&this.translationLanguage&&(i.includeTranslation=!0),await o.reload(i),this.dispatchEvent(new CustomEvent(u.bw,{bubbles:!0,cancelable:!0}));const s={commentId:t,action:d.C.edit,value:!0};return void e.p(e.T.CommentUpdated,s)}{const[t]=c||l||[],o=e.c("faceplate-alert",{level:e.a5.error,message:t?.message||a,cause:e.cv.QueryBadResponse});this.dispatchEvent(o),e.i(this,G())}}catch(t){window.Sentry?.captureMessage?.(`Error updating comment: ${t?.message}`);const o=e.c("faceplate-alert",{level:e.a5.error,message:a,cause:e.cv.UncaughtError});this.dispatchEvent(o),e.i(this,G())}var r;this.updateCommentButton("idle")}renderDraftConfirmationModal(){const o=t.x` <rpl-modal-card auto-close class="max-w-[400px]"> <h2 slot="title"> ${"Save Draft?"} </h2> <p class="m-0"> ${"Save this comment as a draft and come back to finish it within the next 14 days."} </p> ${e.o({appearance:"secondary",attributes:{slot:"close-button"},leadingIcon:e.al()})} ${e.o({appearance:"primary",attributes:{slot:"primary-button",onclick:this.handleDraftSave},children:"Save"})} ${e.o({appearance:"secondary",attributes:{slot:"secondary-button",onclick:this.handleDraftDiscard},children:"Discard"})} </rpl-modal-card> `;return t.x`<rpl-dialog-sheet .litTemplateChildren="${o}" id="draft-discard-dialog"></rpl-dialog-sheet>`}renderCancelConfirmationModal(){return t.x` <faceplate-modal id="comment-discard-modal" class="min-h-[auto]"> <div slot="title"> ${"Discard comment?"} </div> <div slot="closeButton"> ${e.o({appearance:"secondary",leadingIcon:e.al({size:t.I.Small}),size:e.q.Small,attributes:{"aria-label":"Cancel",onclick:this.handleCancelAbort}})} </div> <div class="mb-0 w-[350px]"> <p class="mt-md text-body-2 text-neutral-content"> ${"You have a comment in progress, are you sure you want to discard it?"} </p> <div class="mt-lg flex gap-md"> ${e.o({size:e.q.Medium,appearance:"secondary",children:"Cancel",attributes:{className:"w-1/2",onclick:this.handleCancelAbort,"data-testid":"cancel-button"}})} ${e.o({size:e.q.Medium,appearance:"destructive",children:"Discard",attributes:{className:"w-1/2",onclick:this.handleCancelConfirmation,"data-testid":"confirm-button"}})} </div> </div> </faceplate-modal> `;}renderTranslationContributionModal(){return t.x`<translation-contribution-modal modal-type="${n.M.COMMENT}" .handleTranslationConfirmClick="${()=>{this.handleTranslationConfirmClick()}}" .handleTranslationRefuseClick="${()=>{this.handleTranslationRefuseClick()}}"></translation-contribution-modal>`}renderValidationMessage(){const e=this.getComposer()?.validationMessage;return this.isComposerDirty&&e&&e!==x?t.x`<div class="gap-xs flex items-center text-alert-negative"> ${o.e({size:t.I.Small,attributes:{className:"text-alert-negative"}})} <p class="text-caption-1 m-0" aria-live="polite" id="${this.getDescribedById()}"> ${e} </p> </div>`:null}renderCommentGuidance(){return this.commentGuidanceController.commentGuidanceRuleOutcomes.length?t.x`<automation-rule-triggered-rules automation-outcomes="${JSON.stringify(this.commentGuidanceController.commentGuidanceRuleOutcomes)}" ?has-focus="${this.commentGuidanceController.hasFocus}" make-errors-red no-margin-after is-comment-composer></automation-rule-triggered-rules>`:null}renderMessages(){const e=this.renderValidationMessage(),o=this.renderCommentGuidance();return e||o?t.x`<div class="px-md pt-xs pb-2xs"> ${e??t.A} ${o??t.A} </div>`:t.A}render(){const e=this.shouldDisplayContent?t.x`<slot name="ready"></slot>`:t.x`<slot></slot>`,o=this.isTranslationContribution&&this.translationLanguage&&this.translationContextValue.showCommentTranslationModal;return t.x`${e}${this.renderMessages()} ${this.shouldEnableDrafts?this.renderDraftConfirmationModal():this.renderCancelConfirmationModal()} ${o?this.renderTranslationContributionModal():""}`}};return K.styles=[e.t],e._([e.n({type:Boolean,attribute:"is-check-comment-guidance-availability-set"})],K.prototype,"isCheckCommentGuidanceAvailabilitySet",void 0),e._([e.n({type:Boolean,attribute:"is-perform-comment-guidance-evaluation-set"})],K.prototype,"isPerformCommentGuidanceEvaluationSet",void 0),e._([e.n({type:Boolean,attribute:"perform-evaluate-automations-on-submit"})],K.prototype,"performEvaluateAutomationsOnSubmit",void 0),e._([e.n({type:String,attribute:"composer-session-id"})],K.prototype,"composerSessionId",void 0),e._([e.h()],K.prototype,"shouldDisplayContent",void 0),e._([e.h()],K.prototype,"isTranslatedCommentSubmit",void 0),e._([e.aP({context:e.aR,subscribe:!0}),e.h()],K.prototype,"translationContextValue",void 0),e._([e.a2("faceplate-modal#comment-discard-modal")],K.prototype,"cancelConfirmationModal",void 0),e._([e.a2("rpl-dialog-sheet#draft-discard-dialog")],K.prototype,"draftConfirmationModal",void 0),e._([e.a2("translation-contribution-modal")],K.prototype,"commentTranslationModal",void 0),e._([e.n({type:String,attribute:"post-id"})],K.prototype,"postId",void 0),e._([e.n({type:String,attribute:"comment-id"})],K.prototype,"commentId",void 0),e._([e.n({type:String,attribute:"user-id"})],K.prototype,"userId",void 0),e._([e.n({type:String,attribute:"parent-id"})],K.prototype,"parentId",void 0),e._([e.n({type:Boolean,attribute:"edit-mode"})],K.prototype,"isInEditMode",void 0),e._([e.n({type:Boolean,attribute:"reply-mode"})],K.prototype,"isInReplyMode",void 0),e._([e.n({type:Boolean,attribute:"is-mobile"})],K.prototype,"isMobile",void 0),e._([e.n({type:Boolean,attribute:"autofocus"})],K.prototype,"autofocus",void 0),e._([e.n({type:String,attribute:"translation-language",reflect:!0})],K.prototype,"translationLanguage",void 0),e._([e.n({type:Boolean,attribute:"is-translation-contribution",reflect:!0})],K.prototype,"isTranslationContribution",void 0),e._([e.n({type:Boolean,attribute:"should-show-success-alert",reflect:!0})],K.prototype,"shouldShowSuccessAlert",void 0),e._([e.n({type:Boolean,attribute:"comment-drafts-enabled"})],K.prototype,"isCommentDraftsEnabled",void 0),K=e._([e.e("comment-composer-host")],K),{get CommentComposerHost(){return K}}}));
SML.di("./_C4HT6j0ig.js",import.meta.url,"_C4HT6j0ig");SML.di("./tO6bKRQro7.js",import.meta.url,"tO6bKRQro7");SML.di("./CBbxnHsw2W.js",import.meta.url,"CBbxnHsw2W");SML.di("./CMwg6atOpj.js",import.meta.url,"CMwg6atOpj");SML.di("./BWv2j8jrjX.js",import.meta.url,"BWv2j8jrjX");SML.di("./jFB0DOsi41.js",import.meta.url,"jFB0DOsi41");SML.di("./av6qvYZJJ7.js",import.meta.url,"av6qvYZJJ7");SML.di("./Dw4vb8Yfbm.js",import.meta.url,"Dw4vb8Yfbm");SML.di("./jWC3N3n7Al.js",import.meta.url,"jWC3N3n7Al");SML.di("./FQGvCwaizg.js",import.meta.url,"FQGvCwaizg");SML.di("./5r73EsgItq.js",import.meta.url,"5r73EsgItq");SML.di("./B-zFJtiar6.js",import.meta.url,"B-zFJtiar6");SML.di("./D_6DXw1u0k.js",import.meta.url,"D_6DXw1u0k");SML.di("./CqGTWb5M_i.js",import.meta.url,"CqGTWb5M_i");SML.di("./DGdjNHBjnV.js",import.meta.url,"DGdjNHBjnV");SML.di("./CRzmHkIoo0.js",import.meta.url,"CRzmHkIoo0");SML.di("./BYpE6FdcdE.js",import.meta.url,"BYpE6FdcdE");SML.di("./BeFppRYbzE.js",import.meta.url,"BeFppRYbzE");SML.di("./DHw9yEcfFd.js",import.meta.url,"DHw9yEcfFd");SML.di("./Bu440t6XLo.js",import.meta.url,"Bu440t6XLo");SML.di("./BwcUp7XlaC.js",import.meta.url,"BwcUp7XlaC");SML.di("./BIzQFHISzm.js",import.meta.url,"BIzQFHISzm");SML.di("./BwcMg3lXAs.js",import.meta.url,"BwcMg3lXAs");SML.di("./DnNITwgp90.js",import.meta.url,"DnNITwgp90");SML.di("./CQMf561ZyA.js",import.meta.url,"CQMf561ZyA");SML.di("./Py9rIF7r2a.js",import.meta.url,"Py9rIF7r2a");SML.di("./BQbrDNllG4.js",import.meta.url,"BQbrDNllG4");SML.di("./DoSzdRrY_z.js",import.meta.url,"DoSzdRrY_z");SML.di("./B_mjuylxRt.js",import.meta.url,"B_mjuylxRt");SML.di("./CEs3hLX56z.js",import.meta.url,"CEs3hLX56z");SML.di("./DCbB57ubLb.js",import.meta.url,"DCbB57ubLb");SML.di("./BTnwE85rpZ.js",import.meta.url,"BTnwE85rpZ");SML.di("./JaGlTj3I-9.js",import.meta.url,"JaGlTj3I-9");SML.di("./lEw4CeTWZd.js",import.meta.url,"lEw4CeTWZd");SML.di("./Dw4K28bgT7.js",import.meta.url,"Dw4K28bgT7");SML.di("./Cl1pMDH2OX.js",import.meta.url,"Cl1pMDH2OX");SML.di("./B6Ai7g9fbR.js",import.meta.url,"B6Ai7g9fbR");SML.di("./pA9dwrnd0r.js",import.meta.url,"pA9dwrnd0r");SML.di("./BXUgRcxEAi.js",import.meta.url,"BXUgRcxEAi");SML.di("./w2XkRJ2mzc.js",import.meta.url,"w2XkRJ2mzc");SML.di("./h4Pa0OJr_5.js",import.meta.url,"h4Pa0OJr_5");SML.di("./DFh5Z0Dv0L.js",import.meta.url,"DFh5Z0Dv0L");SML.di("./DS9WepT8W8.js",import.meta.url,"DS9WepT8W8");SML.di("./DZO4dWmzHb.js",import.meta.url,"DZO4dWmzHb");SML.di("./CE5TLxi7Z3.js",import.meta.url,"CE5TLxi7Z3");SML.di("./CUIVPWsUpf.js",import.meta.url,"CUIVPWsUpf");SML.di("./DgW4ULLwQ1.js",import.meta.url,"DgW4ULLwQ1");SML.di("./Chd9fEZKZ6.js",import.meta.url,"Chd9fEZKZ6");SML.di("./CdmJSaSHd8.js",import.meta.url,"CdmJSaSHd8");SML.di("./DEkErsMrK1.js",import.meta.url,"DEkErsMrK1");SML.di("./DCfD6rLr03.js",import.meta.url,"DCfD6rLr03");SML.di("./TELHDd3mgM.js",import.meta.url,"TELHDd3mgM");SML.di("./BYzqEZ3uv3.js",import.meta.url,"BYzqEZ3uv3");SML.di("./Cv4mWnWE30.js",import.meta.url,"Cv4mWnWE30");SML.di("./Dh8G_lEIvS.js",import.meta.url,"Dh8G_lEIvS");SML.di("./DMVINMWPkT.js",import.meta.url,"DMVINMWPkT");SML.di("./B0pL5bhFHV.js",import.meta.url,"B0pL5bhFHV");SML.di("./BtqmVQuPYp.js",import.meta.url,"BtqmVQuPYp");SML.di("./KkXqW5RUm3.js",import.meta.url,"KkXqW5RUm3");SML.di("./DflF56Kkuz.js",import.meta.url,"DflF56Kkuz");SML.di("./CpZ44pmnxI.js",import.meta.url,"CpZ44pmnxI");SML.di("./Dm3xIDznQh.js",import.meta.url,"Dm3xIDznQh");SML.di("./BOIWl4apq6.js",import.meta.url,"BOIWl4apq6");SML.di("./BQXYVRGtud.js",import.meta.url,"BQXYVRGtud");
SML.dm("CKkX_khjgj",["Dw4vb8Yfbm","jWC3N3n7Al","FQGvCwaizg","5r73EsgItq","B-zFJtiar6","CqGTWb5M_i","DGdjNHBjnV","_C4HT6j0ig","tO6bKRQro7","CBbxnHsw2W","CMwg6atOpj","BWv2j8jrjX","jFB0DOsi41","av6qvYZJJ7","D_6DXw1u0k","CRzmHkIoo0","BYpE6FdcdE","BeFppRYbzE","DHw9yEcfFd","Bu440t6XLo","BwcUp7XlaC","BIzQFHISzm","BwcMg3lXAs","DnNITwgp90","CQMf561ZyA","Py9rIF7r2a","BQbrDNllG4","DoSzdRrY_z","B_mjuylxRt","CEs3hLX56z","DCbB57ubLb","BTnwE85rpZ","JaGlTj3I-9","lEw4CeTWZd","Dw4K28bgT7","Cl1pMDH2OX","B6Ai7g9fbR","pA9dwrnd0r","BXUgRcxEAi","w2XkRJ2mzc","h4Pa0OJr_5","DFh5Z0Dv0L","DS9WepT8W8","DZO4dWmzHb","CE5TLxi7Z3","CUIVPWsUpf","DgW4ULLwQ1","Chd9fEZKZ6","CdmJSaSHd8","DEkErsMrK1","DCfD6rLr03","TELHDd3mgM","BYzqEZ3uv3","Cv4mWnWE30","Dh8G_lEIvS","DMVINMWPkT","B0pL5bhFHV","BtqmVQuPYp","KkXqW5RUm3","DflF56Kkuz","CpZ44pmnxI","Dm3xIDznQh","BOIWl4apq6","BQXYVRGtud"],(async(t,e,r,i,a,o,d)=>{function s(t,e){return i.x` <tr> <td class="p-xs border border-tone-3 border-solid">${t}</td> <td class="p-xs border border-tone-3 border-solid">${e}</td> </tr> `}let n=class extends i.s{constructor(){super(...arguments),this.readonly=!1,this.size=t.ic.Small,this._isDirty=!1,this._textareaContainerRef=t.a3(),this.handleTextAreaFocus=()=>{this.dispatchEvent(t.c(t.bS,{},!0))},this.showHelperModal=()=>{this.helperModal?.showModal()},this.hideHelperModal=()=>{this.helperModal?.close()}}get isDirty(){return this._isDirty}set value(t){this.textArea&&(this.textArea.value=t,this.syncTextAreaContainerValue())}get value(){return this.textArea?.value??""}isEmpty(){return 0===this.value.trim().length}syncTextAreaContainerValue(){this._textareaContainerRef.value&&(this._textareaContainerRef.value.dataset.replicatedValue=this.value)}handleInput(){this.syncTextAreaContainerValue()}handleChange(){this._isDirty=!0,this.dispatchEvent(new Event("change",{bubbles:!0}))}renderHelper(){return i.x` <faceplate-modal class="min-h-[auto] w-[calc(100%-3rem)] xs:w-fit"> <h3 slot="title" class="text-18 leading-6 font-bold text-center m-0 py-xs w-full"> ${"Markdown Help"} </h3> <div slot="closeButton" class="absolute end-0 top-0"> ${t.o({appearance:"secondary",leadingIcon:t.al({size:i.I.Small}),size:t.q.Small,attributes:{onclick:this.hideHelperModal,type:"button"}})} </div> <div class="mb-0 w-[350px]"> <p class="text-14 leading-5 font-medium m-0"> ${i.x`Markdown is a way to quickly format text using typed symbols instead of a toolbar. For more help, check the <a href="/r/reddit.com/wiki/markdown/">Reddit Markdown Guide</a>.`} </p> <table class="table-auto mt-lg w-full border-collapse border border-tone-3 border-solid text-12 leading-4"> <thead> <tr class="font-bold"> <th class="p-xs border border-tone-3 border-solid w-1/2 text-start"> ${"Type this"} </th> <th class="p-xs border border-tone-3 border-solid w-1/2 text-start"> ${"To get this"} </th> </tr> </thead> <tbody> ${s("*italics*",i.x`<em>${"italics"}</em>`)} ${s("**bold**",i.x`<strong>${"bold"}</strong>`)} ${s("[reddit!](https://reddit.com)",i.x`<a href="https://reddit.com">reddit!</a>`)} ${s(i.x`*item 1<br>*item 2<br>*item 3`,i.x` <ul class="ps-sm m-0"> ${i.x`<li>item 1</li> <li>item 2</li> <li>item 3</li>`} </ul> `)} ${s(">quoted text",i.x` <blockquote class="inline-block ps-2xs m-0 border-e-0 border-t-0 border-b-0 border-solid border-s-lg border-l-tone-3"> ${"quoted text"} </blockquote> `)} ${s("~~strikethrough~~",i.x`<del> ${"strikethrough"} </del>`)} ${s("super^script",i.x`super<sup>script</sup>`)} ${s(">!spoilers!<",i.x` <shreddit-spoiler> ${"spoilers"} </shreddit-spoiler> `)} </tbody> </table> </div> </faceplate-modal> `;}focus(){this.textArea?this.textArea.focus():this.updateComplete.then((()=>this.textArea?.focus()))}hasFocus(){return!(!this.textArea||this.shadowRoot?.activeElement!==this.textArea)}renderAutoGrowingTextArea(){let e=d.S;switch(this.size){case t.ic.Small:e=d.S;break;case t.ic.Large:e=d.b;break;case t.ic.XLarge:e=d.a}return i.x`<div part="textarea-container" class="textarea-container grid ${"after:block after:w-100 after:resize-y after:box-border after:font-mono after:px-md after:py-sm after:leading-5 after:row-start-1 after:row-end-2 after:col-start-1 after:col-end-2 overflow-hidden"} after:invisible after:whitespace-pre-wrap" data-replicated-value="${this.initialValue??""}" ${t.a4(this._textareaContainerRef)}> <textarea part="textarea-input" class="${e} rounded-1 bg-transparent border-none outline-none text-neutral-content-strong text-14 disabled:bg-interactive-background-disabled ${"block w-100 resize-y box-border font-mono px-md py-sm leading-5 row-start-1 row-end-2 col-start-1 col-end-2"} overflow-hidden text-inherit" placeholder="${this.placeholder}" @focus="${this.handleTextAreaFocus}" @change="${this.handleChange}" @input="${this.handleInput}" ?disabled="${this.readonly}" spellcheck="true" .value="${this.initialValue??""}"></textarea> </div>`}render(){return i.x` <div class="flex items-center justify-between py-2xs"> <div class="text-secondary-weak font-semibold text-12 ps-md flex justify-center items-center"> <span> ${"Markdown Editor"} </span> ${t.o({appearance:"plain",leadingIcon:o.i({size:i.I.ExtraSmall}),size:t.q.Small,attributes:{className:"inline-block ms-xs",title:"Markdown Help",onclick:this.showHelperModal,"data-testid":"btn-markdown-help",type:"button"}})} </div> <div class="pe-xs"> <slot name="header-right"></slot> </div> </div> ${this.renderAutoGrowingTextArea()} ${this.shouldRenderTranslation?i.x`<slot name="translation-bar"></slot>`:""} <slot name="footer"></slot> ${this.renderHelper()} `;}};n.styles=[t.t,i.a`textarea{background-color:var(--color-neutral-background)}.textarea-container::after{content:attr(data-replicated-value) ' '}`],t._([t.n({type:Boolean,attribute:"should-render-translation"})],n.prototype,"shouldRenderTranslation",void 0),t._([t.n({type:String})],n.prototype,"placeholder",void 0),t._([t.n({type:Boolean})],n.prototype,"readonly",void 0),t._([t.n({type:String,attribute:"value"})],n.prototype,"initialValue",void 0),t._([t.n({type:String})],n.prototype,"size",void 0),t._([t.a2("textarea")],n.prototype,"textArea",void 0),t._([t.a2("faceplate-modal")],n.prototype,"helperModal",void 0),n=t._([t.e("shreddit-markdown-composer")],n);let l=class extends(e.T()){constructor(){super(...arguments),this.nextValue={[t.bR.RichText]:void 0,[t.bR.Markdown]:void 0},this.events=new t.E(this),this.mode=t.bR.RichText,this.readonly=!1,this.placeholder="",this.hideRichText=!1,this.recordMark=!1,this.translationContextValue=t.aQ,this.size=t.ic.Small,this.hasError=!1,this._isDirty=!1,this.setIsDirty=()=>{this._isDirty=!0},this.resetIsDirty=()=>{this._isDirty=!1},this.getValueAs=async t=>this.mode===t?this.value:await this.convertValue(t),this.convertValue=async e=>{const r=e===t.bR.Markdown?{operation:t.O.ConvertRTJSONToMarkdown,variables:{rtjson:JSON.stringify(this.getRichTextValue())}}:{operation:t.O.ConvertMarkdownToRTJSON,variables:{markdown:this.getMarkdownValue()}},{data:{convertedValue:i}}=await t.Y(r);if(e===t.bR.Markdown)return i?.replaceAll(/[\r\n]?!\[\w*\]\([\w|]*\)[\r\n]?/g,"");{let t=JSON.parse(i??""),e=0;for(;"string"==typeof t&&e<3;)e++,t=JSON.parse(t);if("string"==typeof t)throw new Error("Unable to resolve RTJSON string");return t}},this.onModeSwitch=async e=>{try{this.nextValue[e]=await this.convertValue(e)}catch(r){const i=e===t.bR.Markdown?this.getModeText(t.bR.Markdown):this.getModeText(t.bR.RichText),a=e===t.bR.Markdown?this.getModeText(t.bR.RichText):this.getModeText(t.bR.Markdown),o=t.c("faceplate-alert",{level:t.a5.error,cause:"uncategorized",message:`There was a problem converting from ${i} to ${a}. Please try again later.`});return void this.dispatchEvent(o)}this.mode=e,this.dispatchEvent(t.c(t.fN,{activeMode:e})),await this.updateComplete,this.dispatchInputEvent()},this.toggleMode=()=>{this.mode===t.bR.RichText?this.onSwitchToMarkdown():this.onSwitchToRichText()},this.onModeSwitchEvent=async()=>{this.mode===t.bR.RichText&&this.redditRte?.getRichTextMedia()?.length?(await this.modeSwitchModal.confirm())&&this.toggleMode():this.toggleMode()},this.onSwitchToRichText=async()=>{this.onModeSwitch(t.bR.RichText)},this.onSwitchToMarkdown=async()=>{this.onModeSwitch(t.bR.Markdown)},this.handleInput=t=>{t.target!==this&&(t.stopImmediatePropagation(),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})))},this.handleChange=t=>{t.stopImmediatePropagation(),this.dispatchEvent(new Event("change",{bubbles:!0}))},this.onRTEToolbarButtonClick=this.events.define(d.c,(e=>{this.eventSource&&t.i(this,t.b({source:this.eventSource,action:"click",noun:"rte_toolbar"},{action_info:{type:e.detail.name}}))}))}static get styles(){return[t.t,i.a`.error-border{border-color:transparent;box-shadow:0 0 0 var(--rem2) var(--color-danger-content)}shreddit-markdown-composer ::slotted([slot=cancel-button]),shreddit-markdown-composer ::slotted([slot=submit-button]){margin-top:var(--spacer-2xs);margin-bottom:var(--spacer-2xs)}`,super.styles]}getModeText(e){return e===t.bR.RichText?"rich text":"markdown";}firstUpdated(e){super.firstUpdated(e),this.recordMark&&performance.mark(t.bQ)}setCustomValidity(t){const e=super.validationMessage!==t;super.setCustomValidity(t),e&&this.requestUpdate()}isEmpty(){return this.mode===t.bR.RichText?this.redditRte?.isEmpty()??!0:this.markdownComposer?.isEmpty()??!0}isDirty(){const e=this.mode===t.bR.RichText?this.redditRte?.isDirty:this.markdownComposer?.isDirty;return this._isDirty||e}get validationMessage(){return super.validationMessage?super.validationMessage:this.required&&this.isEmpty()?"The field is required and cannot be empty":this.mode===t.bR.RichText&&this.redditRte?.validationMessage?this.redditRte.validationMessage:"";}reportValidity(){return this.requestUpdate(),this.checkValidity()}checkValidity(){const t=""===this.validationMessage;return t||this.dispatchEvent(new Event("invalid",{bubbles:!0,composed:!0})),this.isDirty()&&!t?(this.hasError=!0,this.setAttribute("aria-invalid","true")):(this.hasError=!1,this.removeAttribute("aria-invalid")),t}async connectedCallback(){super.connectedCallback(),this.initialMode=this.mode,this.classList.add("block"),this.setAttribute("aria-required",(!!this.required).toString());const t=await r.c(this);t&&this.isConnected&&(this._form=t,this._form.addEventListener("faceplate-submit",this.setIsDirty))}disconnectedCallback(){super.disconnectedCallback(),this._form?.removeEventListener("faceplate-submit",this.setIsDirty)}getShouldRenderTranslations(){const t=this.closest("comment-composer-host");return(this.isTranslationEligible||!!t?.translationLanguage)&&this.translationContextValue.isTranslationActive}focus(){this.mode===t.bR.RichText?this.redditRte?.focus():this.markdownComposer?.focus()}hasFocus(){return this.mode===t.bR.RichText?!!this.redditRte?.hasFocus():!!this.markdownComposer?.hasFocus()}getRichTextValue(){const t=this.redditRte?.getRTJSON();return JSON.stringify(t)}get richTextMedia(){return JSON.stringify(this.redditRte?.getRichTextMedia())}get hasMedia(){return this.mode===t.bR.RichText&&0!==this.redditRte?.getRichTextMedia()?.length||!1}getMarkdownValue(){return this.markdownComposer?.value??""}clearRichTextValue(){this.redditRte?.clear()}clearMarkdownValue(){this.markdownComposer&&(this.markdownComposer.value="")}clearValidationMessage(){super.setCustomValidity(""),this.requestUpdate()}set value(e){this.mode===t.bR.RichText?this.updateComplete.then((()=>this.redditRte?.setRTJSON(e))):this.updateComplete.then((()=>{this.markdownComposer&&(this.markdownComposer.value=e)}))}get value(){return this.mode===t.bR.RichText?this.getRichTextValue():this.getMarkdownValue()}get plainText(){return this.isEmpty()?"":this.mode===t.bR.RichText?this.redditRte?.getPlainText()??"":this.getMarkdownValue()}clear(){this.clearRichTextValue(),this.clearMarkdownValue(),this.resetIsDirty(),this.clearValidationMessage()}reset(){this.clear(),this.mode=this.initialMode||this.mode,this.updateComplete.then((()=>{this.redditRte?.reset(),this.markdownComposer&&(this.markdownComposer.value=this.initialValue||"")}))}dispatchInputEvent(){this.dispatchEvent(new InputEvent("input",{bubbles:!0}))}willUpdate(e){const r=e.get("mode");r&&(r===t.bR.RichText?this.clearRichTextValue():this.clearMarkdownValue())}updated(t){!!t.get("mode")&&(this.nextValue[this.mode]&&(this.value=this.nextValue[this.mode]),this.focus()),t.has("required")&&this.setAttribute("aria-required",(!!this.required).toString())}renderPendingModeSwitchModalMedia(){const t="Switch to markdown?",e="You'll lose any images, gifs, or videos you've added.",r="Yes, Switch";return i.x` <confirmation-modal title="${t}" message="${e}" confirm-text="${r}"> </confirmation-modal> `}renderActionButtons(){return i.x` <slot name="submit-button"></slot> <slot name="cancel-button"></slot> `}render(){return i.x` <div class="border border-solid rounded-5 bg-neutral-background border-neutral-border focus-within:border-neutral-border-medium ${this.hasError?"error-border":""}"> <slot name="preamble"></slot> ${a.ct(this.mode===t.bR.RichText?i.x`<reddit-rte slot="rteComposer" @change="${this.handleChange}" value="${t.ad(this.initialMode===t.bR.RichText?this.initialValue:void 0)}" @input="${this.handleInput}" ?readonly="${this.readonly}" ?should-render-translation="${this.getShouldRenderTranslations()}" placeholder="${this.placeholder}" size="${this.size}"> <slot name="rte"></slot> <slot name="rte-toolbar-additions" slot="toolbar-additions"></slot> <slot name="placeholder-html" slot="placeholder-html"></slot> ${!this.hideRichText&&t.o({size:t.q.Small,appearance:"plain",children:"Switch to Markdown",shape:"pill",attributes:{onclick:this.onModeSwitchEvent,slot:"top-toolbar-right",type:"button",disabled:this.readonly,className:"ms-auto","aria-label":"Switch to Markdown"}})} ${this.getShouldRenderTranslations()?i.x`<div slot="translation-bar"><slot name="translation-toggle"></slot></div>`:""} <div class="flex flex-row-reverse gap-xs items-center justify-end ms-auto" slot="action-bar-right"> ${this.renderActionButtons()} </div> </reddit-rte>`:i.x` <shreddit-markdown-composer exportparts="textarea-input,textarea-container" class="block w-100" @change="${this.handleChange}" value="${t.ad(this.initialMode===t.bR.Markdown?this.initialValue:void 0)}" ?readonly="${this.readonly}" ?should-render-translation="${this.getShouldRenderTranslations()}" placeholder="${this.placeholder}" size="${this.size}"> ${this.getShouldRenderTranslations()?i.x`<div slot="translation-bar"> <slot name="translation-toggle"></slot> </div>`:""} <div class="flex flex-row-reverse gap-xs items-center justify-start px-xs" slot="footer"> ${this.renderActionButtons()} </div> ${!this.hideRichText&&t.o({size:t.q.Small,appearance:"plain",children:"Switch to Rich Text Editor",shape:"pill",attributes:{onclick:this.onModeSwitchEvent,slot:"header-right",type:"button",disabled:this.readonly,"aria-label":"Switch to Rich Text Editor"}})} </shreddit-markdown-composer> `)} </div> ${this.renderPendingModeSwitchModalMedia()} `;}};t._([t.a2("reddit-rte")],l.prototype,"redditRte",void 0),t._([t.a2("shreddit-markdown-composer")],l.prototype,"markdownComposer",void 0),t._([t.a2("confirmation-modal")],l.prototype,"modeSwitchModal",void 0),t._([t.n({type:String})],l.prototype,"mode",void 0),t._([t.n({type:String,attribute:"value"})],l.prototype,"initialValue",void 0),t._([t.n({type:Boolean})],l.prototype,"required",void 0),t._([t.n({type:Boolean})],l.prototype,"readonly",void 0),t._([t.n({type:String})],l.prototype,"placeholder",void 0),t._([t.n({type:Boolean,attribute:"hide-rich-text"})],l.prototype,"hideRichText",void 0),t._([t.n({type:String,attribute:"event-source"})],l.prototype,"eventSource",void 0),t._([t.n({type:Boolean,attribute:"record-mark"})],l.prototype,"recordMark",void 0),t._([t.aP({context:t.aR,subscribe:!0}),t.h()],l.prototype,"translationContextValue",void 0),t._([t.n({type:Boolean,attribute:"is-translation-eligible"})],l.prototype,"isTranslationEligible",void 0),t._([t.n({type:String})],l.prototype,"size",void 0),t._([t.n({type:Number,attribute:"maxlength"})],l.prototype,"maxLength",void 0),t._([t.h()],l.prototype,"hasError",void 0),t._([t.h()],l.prototype,"_isDirty",void 0),l=t._([t.e("shreddit-composer")],l);var h=Object.freeze({__proto__:null,get ShredditComposer(){return l}});return{get s(){return h}}}));